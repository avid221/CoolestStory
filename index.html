<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <title>Cool Story Bro</title>
    <link rel="stylesheet" href="css/index.css" />
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBkqioUZBKHC9K_6aUQZjQ0EXlQXaYIkQo&sensor=false&libraries=visualization">
    </script>
    <script type="text/javascript" src="jquery-1.9.1.js"> </script>
    <script type="text/javascript">
      var markers = [];
      var crimes = [];

      //Dropdown Magic
      function DropDown(el) {
        this.dd = el;
        this.opts = this.dd.find('ul.dropdown > li');
        this.val = [];
        this.index = [];
        this.initEvents();
      }

      DropDown.prototype = {
        initEvents : function() {
          var obj = this;

          obj.dd.on('click', function(event){
            $(this).toggleClass('active');
            event.stopPropagation();
          });

          obj.opts.children('label').on('click',function(event){
            var opt = $(this).parent(),
              chbox = opt.children('input'),
              val = chbox.val(),
              idx = opt.index();

            ($.inArray(val, obj.val) !== -1) ? obj.val.splice( $.inArray(val, obj.val), 1 ) : obj.val.push( val );
            ($.inArray(idx, obj.index) !== -1) ? obj.index.splice( $.inArray(idx, obj.index), 1 ) : obj.index.push( idx );
          });
        },
        getValue : function() {
          return this.val;
        },
        getIndex : function() {
          return this.index;
        }
      }

      $(function() {

        var dd = new DropDown( $('#dd') );

        $(document).click(function() {
          // all dropdowns
          $('.wrapper-dropdown-4').removeClass('active');
        });

      });

      function initialize() {
        var styles = [
          {
            stylers: [
              //{ hue: "#00ffe6" },
              { saturation: -100 },
              { weight: 1.8}
            ]
          },{
            featureType: "road",
            elementType: "geometry",
            stylers: [
              { lightness: 100 },
              { visibility: "on" }
            ]
          },{
            featureType: "road",
            elementType: "labels",
            stylers: [
              { visibility: "on" },
              { lightness: 45}
            ]
         }
        ];

        var styledMap = new google.maps.StyledMapType(styles, {name: "Cool Story Bro"});

        var mapOptions = {
          center: new google.maps.LatLng(33.4486, -112.0743),
          noClear: true,
          zoom: 13,
          mapTypeControlOptions: {
            mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
          }
        };
        map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

        map.mapTypes.set('map-style', styledMap);
        map.setMapTypeId('map-style');

        //Bounded Box of Phoenix
        var allowedBounds = new google.maps.LatLngBounds(
          new google.maps.LatLng(33.353, -112.319),
          new google.maps.LatLng(33.787, -111.833)
        );

        //Grab last center of Map
        var lastValidCenter = map.getCenter();
        console.log('The first center ' + lastValidCenter);
        //Lock the user to Phoenix area by checking center positions queued by panning
        google.maps.event.addListener(map, 'center_changed', function() {
          if(allowedBounds.contains(map.getCenter())) {
            //still within Phoenix, save position
            lastValidCenter = map.getCenter();
            return;
          }

          //not in Phoenix, lets get back
          map.panTo(lastValidCenter);
        });

        // Limit the zoom level
        google.maps.event.addListener(map, 'zoom_changed', function() {
          if (map.getZoom() < 10) map.setZoom(10);
        });

        var heatmap = new google.maps.visualization.HeatmapLayer({
          data: crimes
        });

        heatmap.setMap(map);

      }


      //Window Open, setup the map
      google.maps.event.addDomListener(window, 'load', initialize);

      //Open the Business JSON and plot the Business on Map
      $.getJSON('data/yelpBusiness.json', function(data) {
        $.each(data, function(key, val) {
          var image = 'images/default.png';

          //Some Restaurants are not Food
          if (val['categories'].indexOf('Restaurants') != -1){
            var image = 'images/restaurant.png';
            if (val['categories'].indexOf('Indian') != -1){
              var image = 'images/indian.png';
            }
            if (val['categories'].indexOf('Korean') != -1){
              var image = 'images/korean.png';
            }
            if (val['categories'].indexOf('Greek') != -1){
              var image = 'images/greek.png';
            }
            if (val['categories'].indexOf('Japanese') != -1){
              var image = 'images/japanese.png';
            }
            if (val['categories'].indexOf('Chinese') != -1){
              var image = 'images/chinese.png';
            }
            if (val['categories'].indexOf('Mexican') != -1){
              var image = 'images/mexican.png';
            }
            if (val['categories'].indexOf('Italian') != -1){
              var image = 'images/italian.png';
            }
          }
   
          //Food Section
          if (val['categories'].indexOf('Food') != -1) {
            var image = 'images/food.png';
            if (val['categories'].indexOf('Restaurants') != -1){
              var image = 'images/restaurant.png';
              if (val['categories'].indexOf('Indian') != -1){
                var image = 'images/indian.png';
              }
              if (val['categories'].indexOf('Korean') != -1){
                var image = 'images/korean.png';
              }
              if (val['categories'].indexOf('Greek') != -1){
                var image = 'images/greek.png';
              }
              if (val['categories'].indexOf('Japanese') != -1){
                var image = 'images/japanese.png';
              }
              if (val['categories'].indexOf('Chinese') != -1){
                var image = 'images/chinese.png';
              }
              if (val['categories'].indexOf('Mexican') != -1){
                var image = 'images/mexican.png';
              }
              if (val['categories'].indexOf('Italian') != -1){
                var image = 'images/italian.png';
              }
            }
            if (val['categories'].indexOf('Fast Food') != -1){
              var image = 'images/fastfood.png';
            }
            if(val['categories'].indexOf('Bakeries') != -1){
              var image = 'images/bakeries.png';
            }
            if(val['categories'].indexOf('Grocery') != -1){
              var image = 'images/grocery.png';
            }
            if(val['categories'].indexOf('Sandwiches') != -1){
             var image = 'images/sandwich.png';
            }
            if (val['categories'].indexOf('Pizza') != -1){
              var image = 'images/pizza.png';
            }
          }

          //Drink Section
          if(val['categories'].indexOf('Bars') != -1){
            var image = 'images/bars.png';
          }
          if(val['categories'].indexOf('Coffee & Tea') != -1 || val['categories'].indexOf('Cafes') != -1){
            var image = 'images/coffee.png';
          }
          if(val['categories'].indexOf('Shopping') != -1){
            var image = 'images/shopping.png';
          }

          //Health Section
          if(val['categories'].indexOf('Health & Medical') != -1) {
            var image = 'images/health.png';
            if(val['categories'].indexOf('Dentists') != -1 || val['categories'].indexOf('General Dentistry') != -1 || val['categories'].indexOf('General Dentistry') != -1) {
              var image = 'images/dentist.png';
            }
            if(val['categories'].indexOf('Hospitals') != -1) {
              var image = 'images/hospital.png';
            }
            if(val['categories'].indexOf('Pharmacy') != -1) {
              var image = 'images/pharmacy.png';
            }
          }

          if(val['categories'].indexOf('Golf') != -1 || val['categories'].indexOf('Mini Golf') != -1) {
            var image = 'images/golf.png';
          }

          if(val['categories'].indexOf('Parks') != -1) {
            var image = 'images/park.png';
            if(val['categories'].indexOf('Skate Parks') != -1) {
              var image = 'images/park.png';
            }
          }
          if(val['categories'].indexOf('Gyms') != -1) {
            var image = 'images/gym.png';
          }
          if(val['categories'].indexOf('Hotels') != -1) {
            var image = 'images/hotels.png';
          }
          if(val['categories'].indexOf('Beauty & Spas') != -1) {
            var image = 'images/beauty.png';
          }
          if(val['categories'].indexOf('Churches') != -1) {
            var image = 'images/church.png';
          }
          if(val['categories'].indexOf('Casinos') != -1) {
            var image = 'images/casino.png';
          }
          var myLatLng = new google.maps.LatLng(val['latitude'], val['longitude']);

          // Create Marker
          var marker = new google.maps.Marker({
            position: myLatLng,
            map: map,
            title: val['name'],
            icon: new google.maps.MarkerImage(image,null,null,null, new google.maps.Size(25,27))
          });

          marker.category = val['categories'];
          marker.name = val['name'];

          //Add Marker to Marker List
          markers.push(marker);

          //Show Details of Marker when Clicked in Side Panel
          google.maps.event.addListener(marker, 'click', function() {
            document.getElementById("name_val").innerText=val['name'];
            document.getElementById("add_val").innerText=val['full_address'];
            document.getElementById("cat_val").innerText=val['categories'];
            document.getElementById("review_val").innerText=val['review_count'];
            document.getElementById("rate_val").innerText=val['stars'] + ' out of 5.';


            //Show Details and Hide Instructions
            document.getElementById("tab").style.display = 'block';
            document.getElementById("ins").style.display = 'none';
          });
        });
      });
      
      //Crime Data
      $.getJSON('testData/testcrimes.json', function(data) {
        $.each(data, function(key, val) {
          var crime = new google.maps.LatLng(val['coords'][0],val['coords'][1]);
          console.log(crime);
          crimes.push(crime);
        });
      });
    </script>
  </head>

  <body>
    <div id="business-filters">
      <div id="dd" class="wrapper-dropdown-4">Businesses
        <ul class="dropdown">
          <li><input type="checkbox" id="el-1" name="el-1" value="donut"><label for="el-1">Eat a donut</label></li>
          <li><input type="checkbox" id="el-2" name="el-2" value="neighbour"><label for="el-2">Spy on my neighbours</label></li>
          <li><input type="checkbox" id="el-3" name="el-3" value="T-rex"><label for="el-3">Feed my T-rex</label></li>
        </ul>
      </div>
    </div>
    <div id="map-canvas"/> </div>
    <div id="info">
      <div class='container'>
        <div id='ins' class='instruct'>
          <div class='itext'><p class="blank">Click on a business to begin.</p></div>
        </div>
        <div id="tab" class="details">
          <ul class="vtabs"><li class="active"><a href="#tab3_1">Details</a></li></ul>
          <div id="admin" class="vinner">
            <div class="drow">
              <div class="dlabel">Name</div>
              <div id="name_val" class="dvalue"></div>
            </div>
            <div class="drow">
              <div class="dlabel">Address</div>
              <div id="add_val" class="dvalue"></div>
            </div>
            <div class="drow">
              <div class="dlabel">Category</div>
              <div id="cat_val" class="dvalue"></div>
            </div>
            <div class="drow">
              <div class="dlabel">Review Count</div>
              <div id="review_val" class="dvalue"></div>
            </div>
            <div class="drow">
              <div class="dlabel">Rating</div>
              <div id="rate_val" class="dvalue"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>