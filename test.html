<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <script type="text/javascript"
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBkqioUZBKHC9K_6aUQZjQ0EXlQXaYIkQo&sensor=false">
    </script>
    <script type="text/javascript" src="jquery-1.9.1.js"> </script>
    <script type="text/javascript">
      function initialize() {
        var styles = [
          {
            stylers: [
              //{ hue: "#00ffe6" },
              { saturation: -100 },
              { weight: 1.8}
            ]
          },{
            featureType: "road",
            elementType: "geometry",
            stylers: [
              { lightness: 100 },
              { visibility: "on" }
            ]
          },{
            featureType: "road",
            elementType: "labels",
            stylers: [
              { visibility: "on" },
              { lightness: 45}
            ]
         }
        ];

        var styledMap = new google.maps.StyledMapType(styles, {name: "Cool Story Bro"});

        var mapOptions = {
          center: new google.maps.LatLng(33.4486, -112.0743),
          zoom: 13,
          mapTypeControlOptions: {
            mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style']
          }
        };
        map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

        map.mapTypes.set('map-style', styledMap);
        map.setMapTypeId('map-style');

        //Bounded Box of Phoenix
        var allowedBounds = new google.maps.LatLngBounds(
          new google.maps.LatLng(33.353, -112.319),
          new google.maps.LatLng(33.787, -111.833)
        );

        //Grab last center of Map
        var lastValidCenter = map.getCenter();
        console.log('The first center ' + lastValidCenter);
        //Lock the user to Phoenix area by checking center positions queued by panning
        google.maps.event.addListener(map, 'center_changed', function() {
          if(allowedBounds.contains(map.getCenter())) {
            //still within Phoenix, save position
            lastValidCenter = map.getCenter();
            return;
          }

          //not in Phoenix, lets get back
          map.panTo(lastValidCenter);
        });

        // Limit the zoom level
        google.maps.event.addListener(map, 'zoom_changed', function() {
          if (map.getZoom() < 13) map.setZoom(13);
        });
      }
      //Window Open, setup the map
      google.maps.event.addDomListener(window, 'load', initialize);

      //Open the Business JSON and plot the Business on Map
      $.getJSON('data/yelpBusiness.json', function(data) {
        $.each(data, function(key, val) {
          var image = 'images/mm_20_green.png';
          if (!val['categories'].indexOf('Food') || !val['categories'].indexOf('Restaurants')) {
            var image = 'images/food.png';
          }
          if(!val['categories'].indexOf('Bars')){
            var image = 'images/bars.png';
          }
          if(!val['categories'].indexOf('Coffee & Tea')){
            var image = 'images/coffee.png';
          }
          if(!val['categories'].indexOf('Shopping')){
            var image = 'images/shopping.png';
          }
          if(!val['categories'].indexOf('Health & Medical') || !val['categories'].indexOf('Drugstores')){
            var image = 'images/health.png';
          }
          var myLatLng = new google.maps.LatLng(val['latitude'], val['longitude']);
          //console.log(lo);
          //items.push('<li id="' + key + '">' + val + '</li>');
          new google.maps.Marker({
            position: myLatLng,
            map: map,
            title: val['name'],
            icon: image
          });
        });
      });
    </script>
  </head>
  <body>
    <div id="map-canvas"/>
  </body>
</html>